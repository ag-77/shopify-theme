var storageUrlId="CodeFilterBackUrl";!function(n,c){function l(e){var t=this;t.$element=e,t.storagePanesId=!1,t.storageUrlId=!1,n.code.localStorage&&(t.storagePanesId="CodeFilterPanesState",t.storageUrlId=storageUrlId),t.init()}var r="collectionFiltering";l.prototype.init=function(){var o=this,e=c.location.pathname,e="/"+(e=e.substr(e.indexOf("collections")))+"?view=filters-ajax";n.code.debug&&console.log("Filter init:",c.location.protocol+"//"+c.location.host+e),o.$filterWrapper=n("#filters [data-filter-wrapper]"),n.get(e).done(function(e){e=e.replace(/<!--[\s\S]*?-->/g,""),o.render(e)}),o.$element.on("change",'input[type="checkbox"]',function(){n(this).closest("[data-key-filter]").find('input[type="checkbox"]').not(this).prop("checked",!1),o.updateUrl()}),o.$element.on("click","[data-remove-tag]",function(e){e.preventDefault();e=n(this).data("remove-tag");o.$element.find('.filter-pane input[type="checkbox"][value="'+e+'"]').prop("checked",!1),o.updateUrl()}),o.$element.on("click","[data-filter-clear_all]",function(e){e.preventDefault(),o.$element.find('.filter-pane input[type="checkbox"]').prop("checked",!1),o.updateUrl()}),n.code.localStorage&&o.$element.on("click","[data-collapsible-trigger], [data-collapsible-trigger-icon]",function(){o.filterState={},o.$element.find("[data-filter]").each(function(e,t){var a=n(t).data("filter");o.filterState[a]=n(t).hasClass("collapsible--is-open")}),o.$element.find("[data-filter-list]").each(function(e,t){var a=n(t).data("filter-list");o.filterState[a]=n(t).hasClass("collapsible--is-open")}),localStorage.setItem(o.storagePanesId,JSON.stringify(o.filterState))})},l.prototype.render=function(e){var t=this;n.code.debug&&console.log("Filter data received:",n(e)),n(e).children().length&&(e=n(e).children(),t.options=e.data("filter-options"),t.$filterWrapper.find(".filter-ajax").remove(),t.$filterWrapper.append(e),t.setTabState(),t.$element.find(".filter-load-wrapper:first").removeClass("filter-load-wrapper"))},l.prototype.setTabState=function(){var o=this,e=localStorage.getItem(o.storagePanesId);n.code.localStorage&&e&&(o.filterState=JSON.parse(e),n.each(o.filterState,function(e,t){var a=o.$element.find('[data-filter="'+e+'"]');-1<e.indexOf("-list")&&(a=o.$element.find('[data-filter-list="'+e+'"]')),t||0<a.find("input:checked").length?a.addClass("collapsible--is-open"):a.removeClass("collapsible--is-open")}))},l.prototype.updateUrl=function(){var e=this,t=[];e.$element.find('.filter-pane input[type="checkbox"]:checked').each(function(){var e=n(this).val();-1===t.indexOf(e)&&t.push(e)}),t=t.join("+");var a=c.location.pathname,o=(a=a.substr(a.indexOf("collections"))).split("/"),l=1,r=getParameterByName("page");r!=l&&(l=r);var i="grid",a=getParameterByName("view");a!=i&&(i=a);r="grid",a=getParameterByName("sort_by");a!=r&&(r=a),n.code.localStorage&&localStorage.setItem(e.storageUrlId,JSON.stringify({url:t,collection:o[1],page:l,view:i,sort_by:r}));o="/"+o[0]+"/"+o[1]+"/"+t,o=e.addtoUrl(o,"view",i);o=e.addtoUrl(o,"sort_by",r),n.code.debug&&console.log("Filter update Url:",c.location.protocol+"//"+c.location.host+o),c.location.href=o},l.prototype.addtoUrl=function(e,t,a){var o="";return a&&(o=e.indexOf("?")<0?"?":"&",e+=o+t+"="+a),e},n.fn.collectionFiltering=function(a){var o=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=n(this),t=e.data("plugin_"+r);t?"string"==typeof a&&t[a].apply(t,o):e.data("plugin_"+r,new l(e))})}}(jQuery,(document,window)),$(document).ready(function(){$("#filters").collectionFiltering();var e,t,a=localStorage.getItem(storageUrlId);a&&(a=JSON.parse(a),(t=$('[data-filter="backlink"]')).length&&t.attr("href").replace("/collections/","")==a.collection&&(e="",1<a.page&&(e="?page="+a.page),t.attr("href","/"+a.url+e))),$("#filters").length&&(t=getParameterByName("page")||1,a?t!=parseInt(a.page)&&localStorage.setItem(storageUrlId,JSON.stringify({url:a.url,collection:a.collection,page:t})):(a=(e=(e=window.location.pathname).substr(e.indexOf("collections"))).split("/"),t=getParameterByName("page"),a=a[1],localStorage.setItem(storageUrlId,JSON.stringify({url:e,collection:a,page:t}))))}).on("shopify:section:load",function(e){$("#shopify-section-"+e.detail.sectionId).hasClass("filter-section")&&$("#filters").collectionFiltering("init")}),function(l,o){function r(e){var o=this;o.$element=e,o.storageId="CodeCollectionNav",o.sort_by=getParameterByName("sort_by"),o.view=getParameterByName("view"),o.page=parseInt(getParameterByName("page")),o.$element.find("[data-sort-collection]").each(function(){var e=l(this).data("sort-collection");"undefined"!=e.current&&l(this).find('[value="'+e.current+'"]').prop("selected",!0)}),o.$element.on("change","[data-sort-collection]",function(e){e.preventDefault();var t=l(this).data("sort-collection"),e=l(this).val();o.sort_by="",o.page="",e!=t.default&&(o.sort_by=e),o.goToUrl()}),o.$element.on("change","[data-collection-view]",function(e){e.preventDefault();e=l(this).val();o.view=e,o.goToUrl()}),o.$element.on("click","[data-collection-nav-paging] a",function(e){e.preventDefault();e=l(this).attr("href");o.page=parseInt(getParameterByName("page",e)),o.goToUrl()}),l.code.localStorage&&(o.getCollectionsNav(),o.$element.find("[data-collection-nav-link]").each(function(){var e,t=l(this).data("collection-nav-link"),a=o.collectionsParams[t];a&&(a&&a.view&&(e=o.addtoUrl(t,"view",a.view)),a&&a.sort_by&&(e=o.addtoUrl(e,"sort_by",a.sort_by)),a&&a.page&&(e=o.addtoUrl(e,"page",a.page)),e&&l(this).attr("href",e))}))}var i="collectionNav";r.prototype.addtoUrl=function(e,t,a){var o="";return a&&(o=e.indexOf("?")<0?"?":"&",e+=o+t+"="+a),e},r.prototype.goToUrl=function(){var e=this,t=o.location.pathname,a=o.location.protocol+"//"+o.location.host+t;e.storeCollectionsNav(t);a=e.addtoUrl(a,"view",e.view),a=e.addtoUrl(a,"sort_by",e.sort_by);a=e.addtoUrl(a,"page",e.page),o.location=a},r.prototype.getCollectionsNav=function(){var e;l.code.localStorage&&(this.collectionsParams={},(e=localStorage.getItem(this.storageId))&&(this.collectionsParams=JSON.parse(e)))},r.prototype.storeCollectionsNav=function(e){var t=this;l.code.localStorage&&(t.getCollectionsNav(),t.collectionsParams[e]={page:t.page,view:t.view,sort_by:t.sort_by},localStorage.setItem(t.storageId,JSON.stringify(t.collectionsParams)))},l.fn.collectionNav=function(a){var o=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=l(this),t=e.data("plugin_"+i);t?"string"==typeof a&&t[a].apply(t,o):e.data("plugin_"+i,new r(e))})}}(jQuery,(document,window)),$.code.collectionInit=function(){$("body").collectionNav()},$.code.collectionInit();